<link type="text/css" rel="stylesheet" href="/assets/css/reservation.css" />

<div class="overlay-bg"></div>

<div class="custom-section-wrap" >
  <div class="alert alert-primary custom-logo-top no-icon m-0 alert-dismissible fade show" role="alert">
    Booking
  </div>
  <div class="custom-section" [ngClass]="{'table-loader': state.processing || state.loadingGuest}">
    <ng-container>
      <div class="custom-main template-outer">
        <ng-container *ngIf="state.processing || state.loadingGuest">
          <div class="table-loader">Processing...</div>
        </ng-container>
        <ng-container *ngIf="!state.processing && !state.loadingGuest">
          <div class="custom-content tabs-content" id="content-1" style="display: block;">
            <div class="">
              <!--<div class="input-group mb-4 field-wrap field-gray-wrap traveler-field" *ngIf="profiles.length == 0 || profiles[0]['guestName'] == '<New Profile>'">-->
              <div class="input-group input-full-mobile mb-4 field-wrap field-gray-wrap traveler-field parent-zindex"
                   *ngIf="isCloneAll || (profiles.length == 1 && profiles[0]['guestName'] == '<New Profile>')">
                <span class="user"></span>
                <ng-autocomplete
                  [data]="travelerList"
                  [searchKeyword]="keyword"
                  (selected)='selectTraveler($event)'
                  (inputChanged)='getloadProfiles($event)'
                  (inputFocused)='onFocused($event)'
                  [itemTemplate]="itemTemplateProfiles"
                  (inputCleared)="searchCleared('traveler-list')"
                  [notFoundTemplate]="notFoundProfilesTemplate"
                  [debounceTime]="400"
                  [isLoading]="state.isLoadingTraveler"
                  [minQueryLength]="3"
                  placeHolder="{{'Search Traveler.'}}"
                  class="flex-automate"
                  name="traveler"
                  autocomplete="off"
                >

                </ng-autocomplete>

                <ng-template #itemTemplateProfiles let-item>
                  <a href="javascript:void(0)">
                    <div class="auto-txtwrap text-left">
                      <div class="autotxt" [innerHTML]="item.lastName+'-'+item.firstName">
                      </div>
                    </div>
                  </a>
                </ng-template>

                <ng-template #notFoundProfilesTemplate let-notFound>
                  {{state.errorMsg}}
                </ng-template>
                <div class="" *ngIf="state.error">
                  <label class="error">{{state.error['message']}}</label>
                </div>
                <div _ngcontent-gim-c105="" class="input-group-append">
<!--                  <button type="button" class="btn btn-info ptb-10">Search <span class="fa fa-search position-static font-14 ml-2"></span></button>-->
                  <button type="button" class="btn btn-success ptb-10" (click)="addNewProfile()"> New Profile <span class="fa fa-plus position-static font-14"></span></button>
                </div>
              </div>
              <ng-container *ngIf="profiles.length > 0">
                <div
                  class="accordion custom-accordion accordion-sm text-left" id="accordionExample"
                  [ngClass]="{'accordion-has-book': !profile['resNumber']}"
                  *ngFor="let profile of profiles; let i=index">
                <div class="mb-3">
                  <div class="card-header" id="headingOne">
                    <h2 class="accordion-link has-delete-icon">
                      <span [attr.data-toggle]="(this.profiles.length > 1)?'collapse' : ''"
                            [attr.data-target]="(this.profiles.length > 1) ?'#collaps-'+i : ''"
                            [attr.aria-expanded]="'true'" style="display: block; ">Booking For {{profile.guestName}}</span>
                       <a class="fa fa-trash-o remove-accordion" (click)="removeProfile(i)" *ngIf="isCloneAll"></a>
                      <a *ngIf="!profile['resNumber']" class="btn btn-info btn-book" [ngClass]="{'btn-danger': profile['notValidated']}" (click)="bookProfile(i, profile)">Book <span *ngIf="profile['processing']" class="fa fa-spin fa-spinner"></span></a>
                    </h2>
                  </div>
                  <div id="collaps-{{i}}" class="collapse " [ngClass]="{'show': i == this.profiles.length - 1}" data-parent="#accordionExample">
                    <div class="box box-lr">
                      <div class="alert alert-success alert-dismissible fade show text-center" role="alert" *ngIf="profile['resNumber']">
                        Booking has been made successfuly. view your booking at <a href="#" class="alert-link">{{profile['resNumber']}}</a>
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                        </button>
                      </div>
                      <div class="custom-accordion-wrap">
                        <div class="custom-accordion" *ngFor="let section of profile.inputGroups; let secIndex=index;">
                          <h3 class="" [ngClass]="{'active': secIndex==0}"><a href="javascript:void(0)">{{section.name}}</a></h3>
                          <div class="custom-accordion-content" [ngClass]="{'exp': secIndex == 0}">
                            <div class="row">
                              <div class="col-md-6" *ngFor="let field of section.inputFields">
                                <div class="field-wrap-outer">
                                  <label for="">{{field.name}}<span [ngClass]="{'text-danger': field.isRequired && field.value == ''}"
                                                                    *ngIf="field.isRequired">*</span></label>
                                  <div class="field-wrap" [ngClass]="{}">
                                    <ng-container *ngIf="field.searchField">
                                      <select [disabled]="profile['resNumber']" class="form-control no-icon" [(ngModel)]="field.value" [ngClass]="{
                                        'is-invalid' : field.errorMessage && field.errorMessage != '' && field.isRequired,
                                        'is-valid' : (!field.errorMessage || '' == field.errorMessage)  && field.isRequired,
                                        'has-icon': field.processing, 'no-icon': !field.processing
                                        }" (change)="setValidation(field)">
                                        <option [ngValue]="field.emptyValue || ''"> Select {{field.name}}</option>
                                        <option [ngValue]="option.value" *ngFor="let option of field.searchField.list">{{option.text}}</option>
                                      </select>
                                      <span class="fa fa-spin fa-spinner" *ngIf="field.processing"></span>
                                    </ng-container>
                                    <ng-container *ngIf="!field.searchField">
                                      <input type="text"  [ngClass]="{
                                        'is-invalid' : field.errorMessage && field.errorMessage != '' && field.isRequired,
                                        'is-valid' : (!field.errorMessage || field.errorMessage == '')  && field.isRequired
                                        }"
                                             [disabled]="profile['resNumber']"
                                             placeholder="{{field.name}}"
                                             (keyup)="setValidation(field)"
                                             (blur)="setGuestName(field, i, secIndex)"
                                             [(ngModel)]="field.value" class="form-control no-icon" />
                                    </ng-container>
                                    <label class="error text-danger" *ngIf="field.errorMessage">{{field.errorMessage}}</label>
                                  </div>
                                </div>
                              </div>

                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              </ng-container>
            </div>
          </div>
        </ng-container>
        <!--<br/>
        <button type="submit" class="btn btn-info btn-block" (click)="submitForm()" [disabled]="state.processing">Next <span class="fa fa-spin fa-spinner" *ngIf="state.processing"></span></button>-->
      </div>

    </ng-container>
  </div>
</div>
